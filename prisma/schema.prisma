// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?  @db.Text
  access_token       String?  @db.Text
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?  @db.Text
  session_state      String?
  oauth_token_secret String?
  oauth_token        String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Action {
  id                     String        @id @default(cuid())

  title                  String

  table_name             String?
  action_tags            ActionTag[]

  user_id                String
  timestamp              DateTime      @default(now())

  acted_users            User[]        @relation("acted_users")
  affected_user          User          @relation(fields: [user_id], references: [id], onDelete: NoAction)
}

model ActionTag {
  id                     String        @id
  content                String?
  color                  String?

  actions                Action[]
}

model Audit {
  id            String        @id @default(cuid())
  
  table_name    String
  action        String
  args          String

  timestamp     DateTime      @default(now())
}

model CapsuleProposalSubmission {
  id                            String                        @id @default(cuid())
  project_id                    String                        
  created_at                    DateTime?                     @default(now())
  updated_at                    DateTime?                     @updatedAt
  title                         String
  research_thrust               String
  brief_background              String
  objectives_of_the_study       String
  significance_of_the_study     String
  methodology                   String
  project                       Project @relation(fields: [project_id], references: [id], onDelete: Cascade)

  comments                      Comment[]
}

model Comment {
  id                        String                  @id @default(cuid())
  parent_comment_id         String?                 
                    
  content                   String
  user_id                   String
  created_at                DateTime                @default(now())
  updated_at                DateTime                @updatedAt

  capsule_proposal_submission_id String?
  capsule_proposal    CapsuleProposalSubmission?  @relation(fields: [capsule_proposal_submission_id], references: [id], onDelete: Cascade)

  full_blown_proposal_id String?
  full_blown_proposal_submission    FullBlownProposalSubmission?  @relation(fields: [full_blown_proposal_id], references: [id], onDelete: Cascade)

  deliverable_submission_id String?
  deliverable_submission    DeliverableSubmission?  @relation(fields: [deliverable_submission_id], references: [id], onDelete: Cascade)

  budget_proposal_submission_id String?
  budget_proposal_submission    BudgetProposalSubmission?  @relation(fields: [budget_proposal_submission_id], references: [id], onDelete: Cascade)

  parent_comment            Comment?               @relation("commentsTocomments_parent_comment_id", fields: [parent_comment_id], references: [id], onDelete: Cascade)
  user                      User                   @relation(fields: [user_id], references: [id], onDelete: Cascade)
  other_comments            Comment[]              @relation("commentsTocomments_parent_comment_id")
}

model DeliverableSubmission {
  id             String       @id @default(cuid())
  deliverable_id String       
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  title          String
  description    String?
  deliverable    Deliverable @relation(fields: [deliverable_id], references: [id], onDelete: Cascade)
  comments       Comment[]
}

model BudgetProposalSubmission {
  id             String       @id @default(cuid())
  deliverable_id String       
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  title          String
  description    String?
  project_id     String
  upload_id                        String                         
  project                          Project                           @relation(fields: [project_id], references: [id], onDelete: Cascade)
  file_upload                      FileUpload?                       @relation(fields: [upload_id], references: [id], onDelete: SetNull)

  comments       Comment[]
}

model Deliverable {
  id                      String                    @id @default(cuid())
  deadline                DateTime                 
  title                   String
  description             String?
  created_at              DateTime                  @default(now())
  updated_at              DateTime                  @updatedAt
  project_id              String                    
  project     Project     @relation(fields: [project_id], references: [id], onDelete: Cascade)
  deliverable_submissions DeliverableSubmission[]
}

model Download {
  id           String       @id @default(cuid())
  title        String
  description  String?
  user_id      String
  upload_id    String       
  created_at   DateTime     @default(now())
  updated_at   DateTime     @updatedAt
  file_upload  FileUpload? @relation(fields: [upload_id], references: [id], onDelete: SetNull)
  users        User?        @relation(fields: [user_id], references: [id], onDelete: SetNull)
}

model ExternalResearch {
  id                             String                           @id @default(cuid())
  title                          String                           @unique
  organization                   String?
  main_proponents                String[]
  co_proponents                  String[]
  duration                       String?
  cycle                          String?
  budget                         Float?
  upload_id                      String?                          
  created_at                     DateTime                         @default(now())
  updated_at                     DateTime                         @updatedAt
  project_status_id             String                           @default("not_implemented")
  slug                           String?
  verified                       Boolean                          @default(false)
  project_status                ProjectStatus?                @relation(fields: [project_status_id], references: [id], onDelete: SetNull)
  file_upload                    FileUpload?                    @relation(fields: [upload_id], references: [id], onDelete: SetNull)
  research_presentations         ResearchPresentation[]
  journal_publications           JournalPublication[]
  bridge_users   UserToExternalResearchBridge[]
  disseminations ResearchDissemination[]
}

model FileUpload {
  id                              String                            @id @default(cuid())
  name                            String
  file_type                       String
  mime_type                       String
  size                            Int                               @default(0)
  created_at                      DateTime                          @default(now())
  updated_at                      DateTime                          @updatedAt
  user_id                         String?
  public_access                   Boolean                           @default(false)
  user                            User?                             @relation(fields: [user_id], references: [id], onDelete: SetNull)
  downloads                       Download[]
  external_researches             ExternalResearch[]
  full_blown_proposal_submissions FullBlownProposalSubmission[]
  institute_news                  InstituteNews[]
  research_event_attendances      ResearchEventAttendance[]
  journal_publications            JournalPublication[]
  book_publications               BookPublication[]
  budget_proposal_submissions     BudgetProposalSubmission[]
}

model FullBlownProposalSubmission {
  id                               String                           @id @default(cuid())
  project_id                       String                            
  title                            String
  description                      String?
  created_at                       DateTime?                        @default(now())
  updated_at                       DateTime?                        @updatedAt
  upload_id                        String                           
  project                          Project                           @relation(fields: [project_id], references: [id], onDelete: Cascade)
  file_upload                      FileUpload?                       @relation(fields: [upload_id], references: [id], onDelete: SetNull)

  comments                         Comment[]
}

model InstituteNews {
  id           String        @id @default(cuid())
  title        String        @unique
  slug         String?       @unique
  content      String
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt
  institute_id String?        
  user_id      String?
  upload_id    String?       
  institute    Institute?   @relation(fields: [institute_id], references: [id], onDelete: SetNull)
  uploads      FileUpload[]
  user         User?       @relation(fields: [user_id], references: [id], onDelete: SetNull)
}

model Institute {
  id                  String                @id(map: "institute_pkey") @default(cuid())
  name                String                @unique
  short_name          String?               @unique
  contact_number      String?
  email               String?
  description         String?
  address             String?
  research_areas      String?
  logo_url            String?
  created_at          DateTime?             @default(now())
  updated_at          DateTime?             @updatedAt
  institute_news      InstituteNews[]
  bridge_users UserToInstituteBridge[]
}

model UserToInstituteBridge {
  user_id      String
  institute_id String     
  role_title   String
  duration     String?

  start_date   DateTime?  @default(now())
  end_date     DateTime?

  created_at   DateTime?  @default(now())
  updated_at   DateTime?  @updatedAt
  institute    Institute @relation(fields: [institute_id], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, institute_id])
}

model ResearchEventAttendance {
  id              String       @id @default(cuid())
  verified        Boolean      @default(false)
  user_id         String
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  event_name      String
  start_date      DateTime    
  end_date        DateTime    
  description     String
  proof_upload_id String       
  proof_upload    FileUpload? @relation(fields: [proof_upload_id], references: [id], onDelete: SetNull)
  user            User        @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model ResearchPresentation {
  id                     String                 @id @default(cuid())
  is_external_research   Boolean                @default(false)
  project_id String?                
  external_research_id   String?                
  title                  String                 @unique
  location               String
  event_date             String?             
  created_at             DateTime               @default(now())
  updated_at             DateTime               @updatedAt
  verified               Boolean                @default(false)
  presentors             String[]
  conference             String?
  budget                 Float?
  url                    String?
  slug                   String?                @unique
  external_research      ExternalResearch?   @relation(fields: [external_research_id], references: [id], onDelete: SetNull)
  project    Project? @relation(fields: [project_id], references: [id], onDelete: SetNull)
  bridge_users   UserToResearchPresentationBridge[]
  units Unit[]
}

model UserToResearchPresentationBridge {
  user_id String
  research_presentation_id String
  role_title String

  created_at           DateTime?           @default(now())
  updated_at           DateTime?           @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  research_presentation ResearchPresentation @relation(fields: [research_presentation_id], references: [id], onDelete: Cascade)

  @@id([user_id, research_presentation_id])
}

model ResearchDissemination {
  id                     String                 @id @default(cuid())
  is_external_research   Boolean                @default(false)
  project_id String?                
  external_research_id   String?                
  title                  String                 @unique
  location               String?
  organization           String?
  event_date             String?
  slug                   String?                @unique
  created_at             DateTime               @default(now())
  updated_at             DateTime               @updatedAt
  verified               Boolean                @default(false)
  url                    String?
  bridge_users   UserToResearchDisseminationBridge[]
  external_researches  ExternalResearch[]
  projects  Project[]
  units Unit[]
}

model UserToResearchDisseminationBridge {
  user_id String
  research_dissemination_id String
  role_title String?

  created_at           DateTime?           @default(now())
  updated_at           DateTime?           @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  research_dissemination ResearchDissemination @relation(fields: [research_dissemination_id], references: [id], onDelete: Cascade)

  @@id([user_id, research_dissemination_id])
}

model JournalPublication {
  id                     String                 @id @default(cuid())
  is_external_research   Boolean                @default(false)
  project_id String?                
  external_research_id   String?                
  created_at             DateTime               @default(now())
  proof_upload_id        String?                 
  verified               Boolean                @default(false)
  updated_at             DateTime               @updatedAt
  date_published         DateTime?             
  title                  String                 @unique
  authors                String[]
  issn                   String?
  journal                String?
  url                    String?
  slug                   String?                @unique
  is_indexed             Boolean                @default(false)
  external_researches    ExternalResearch?   @relation(fields: [external_research_id], references: [id], onDelete: SetNull)
  proof_upload           FileUpload?           @relation(fields: [proof_upload_id], references: [id], onDelete: SetNull)
  projects  Project? @relation(fields: [project_id], references: [id], onDelete: SetNull)
  bridge_users   UserToJournalPublicationBridge[]
  units Unit[]
}

model UserToJournalPublicationBridge {
  user_id String
  role_title String?
  created_at           DateTime?           @default(now())
  updated_at           DateTime?           @updatedAt

  journal_publication_id String

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  journal_publication JournalPublication @relation(fields: [journal_publication_id], references: [id], onDelete: Cascade)

  @@id([user_id, journal_publication_id])
}

model BookPublication {
  id                     String                 @id @default(cuid())
  created_at             DateTime               @default(now())
  proof_upload_id        String?                 
  verified               Boolean                @default(false)
  updated_at             DateTime               @updatedAt
  title                  String                 @unique
  authors                String[]
  publisher              String?
  isbn                   String?
  slug                   String?                @unique
  date_published         String?             
  proof_upload           FileUpload?           @relation(fields: [proof_upload_id], references: [id], onDelete: SetNull)
  bridge_users   UserToBookPublicationBridge[]
  units Unit[]
}

model UserToBookPublicationBridge {
  user_id String
  role_title String?
  created_at           DateTime?           @default(now())
  updated_at           DateTime?           @updatedAt

  book_publication_id String

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  book_publication BookPublication @relation(fields: [book_publication_id], references: [id], onDelete: Cascade)

  @@id([user_id, book_publication_id])
}

model ProjectStatus {
  id                    String                  @id
  comment               String?
  external_researches   ExternalResearch[]
  projects Project[]
}

model RevisionRequirement {
  id                    String                @id(map: "revision_requirement_pkey") @default(cuid())
  deadline              DateTime             
  research_id           String                
  title                 String
  description           String?
  created_at            DateTime?             @default(now())
  updated_at            DateTime?             @updatedAt
  projects Project @relation(fields: [research_id], references: [id], map: "revision_requirement_research_id_fkey", onDelete: Cascade)
  revision_submissions  RevisionSubmission?
}

model RevisionSubmission {
  id                    String                @id(map: "revision_submission_pkey") @default(cuid())
  requirement_id        String                @unique(map: "revision_submission_requirement_id_key") 
  title                 String
  description           String?
  created_at            DateTime?             @default(now())
  updated_at            DateTime?             @updatedAt
  revision_requirements RevisionRequirement @relation(fields: [requirement_id], references: [id], map: "revision_submission_requirement_id_fkey", onDelete: Cascade)
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Deadline {
  id                    String                  @id @default(cuid())
  title                 String
  description           String?
  date                  DateTime

  created_at            DateTime?             @default(now())
  updated_at            DateTime?             @updatedAt

  academic_term_id      String
  academic_term         AcademicTerm     @relation(fields: [academic_term_id], references: [id], onDelete: Cascade)
}

model AcademicTerm {
  id                    String                  @id @default(cuid())
  title                 String
  description           String?
  is_current            Boolean               @default(false)

  projects              Project[]
  deadlines             Deadline[]

  start_date            DateTime
  end_date              DateTime
}

model Unit {
  id             String    @id @default(cuid())
  parent_unit_id String?   
  name           String    @unique
  description    String?
  created_at     DateTime? @default(now())
  updated_at     DateTime? @updatedAt
  parent_unit    Unit?    @relation("unitsTounits_parent_unit_id", fields: [parent_unit_id], references: [id], onDelete: Cascade)
  sub_units      Unit[]   @relation("unitsTounits_parent_unit_id")
  users          User[]
  projects Project[]
  journal_publications JournalPublication[]
  book_publications BookPublication[]
  research_presentations ResearchPresentation[]
  research_disseminations ResearchDissemination[]
}

model Project {
  id                               String                             @id @default(cuid())
  title                            String                             @unique
  main_proponents                  String[]
  co_proponents                    String[]
  keywords                         String[]
  abstract                         String?
  duration                         String?
  cycle                            String?
  budget                           Float?
  source_of_fund                   String?
  approved                         Boolean                            @default(false)
  created_at                       DateTime?                          @default(now())
  updated_at                       DateTime?                          @updatedAt
  completed_at                     String?
  project_status_id                String                             @default("not_implemented")
  project_status                   ProjectStatus?                     @relation(fields: [project_status_id], references: [id], onDelete: SetNull)
  slug                             String?                            @unique

  academic_term_id                 String?
  academic_term                    AcademicTerm?     @relation(fields: [academic_term_id], references: [id], onDelete: SetNull)

  capsule_proposal_submissions     CapsuleProposalSubmission[]
  deliverables                     Deliverable[]
  full_blown_proposal_submissions  FullBlownProposalSubmission[]
  budget_proposal_submissions      BudgetProposalSubmission[]
  research_presentations           ResearchPresentation[]
  disseminations                   ResearchDissemination[]
  journal_publications             JournalPublication[]
  revision_requirements            RevisionRequirement[]
  bridge_users                     UserToProjectBridge[]
  units                            Unit[]
}

model UserRole {
  id             String           @id @default("default")
  comment        String?
  users          User[]
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?

  first_name    String?
  middle_initial String?
  last_name     String?
  honorific     String?
  titles        String?

  created_at                     DateTime                         @default(now())
  updated_at                     DateTime                         @updatedAt                     
  units                          Unit[]
  roles                          UserRole[]

  accounts                       Account[]
  comments                       Comment[]
  downloads                      Download[]
  file_uploads                   FileUpload[]
  institute_news                 InstituteNews[]
  research_event_attendances     ResearchEventAttendance[]
  sessions                       Session[]
  actions_made                   Action[]     @relation("acted_users")
  actions_involved               Action[]

  bridge_institutes            UserToInstituteBridge[]
  bridge_book_publications              UserToBookPublicationBridge[]
  bridge_research_presentations         UserToResearchPresentationBridge[]
  bridge_research_disseminations        UserToResearchDisseminationBridge[]
  bridge_journal_publications           UserToJournalPublicationBridge[]
  bridge_external_researches   UserToExternalResearchBridge[]
  bridge_projects UserToProjectBridge[]
}

model UserToExternalResearchBridge {
  external_research_id String              
  role_title           String
  created_at           DateTime?           @default(now())
  updated_at           DateTime?           @updatedAt
  user_id              String
  external_research    ExternalResearch   @relation(fields: [external_research_id], references: [id], onDelete: Cascade)
  user                 User               @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([external_research_id, user_id])
}

model UserToProjectBridge {
  project_id String                
  role_title             String
  created_at             DateTime?             @default(now())
  updated_at             DateTime?             @updatedAt
  admin_positions        String?
  user_id                String
  project    Project    @relation(fields: [project_id], references: [id], map: "user_to_research_research_id_fkey", onDelete: Cascade)
  user                   User                 @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([project_id, user_id])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
